#!/usr/bin/env bash
#netstat will find open ports and -p to show pid and names of sockets and then we use grep to filter the output and display just the listening sockets
# Script to show listening TCP and UDP ports with PID/Program names
# Try with sudo first, fall back to regular netstat if sudo not available

echo "=== Listening TCP and UDP Ports ==="

# Check if netstat is available
if ! command -v netstat &> /dev/null; then
    echo "Error: netstat command not found"
    exit 1
fi

# Try different approaches to get the information
if command -v sudo &> /dev/null && sudo -n true &> /dev/null; then
    # Try with sudo if we have privileges
    echo "Using sudo to show all processes:"
    sudo netstat -tulpn | grep LISTEN
elif [ "$EUID" -eq 0 ]; then
    # Already running as root
    echo "Running as root:"
    netstat -tulpn | grep LISTEN
else
    # Try without privileges
    echo "Running without elevated privileges (may not show all processes):"
    netstat -tuln | grep LISTEN
    echo ""
    echo "Note: Some processes may not be visible without root privileges"
    echo "Run with sudo to see all processes: sudo $0"
fi
